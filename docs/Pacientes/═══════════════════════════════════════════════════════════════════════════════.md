# ═══════════════════════════════════════════════════════════════════════════════
# ONE-SHOT PRP TEMPLATE v5.0
# Goal: One-pass implementation success for NeonPro Patient Page v2
# ═══════════════════════════════════════════════════════════════════════════════

metadata:
  complexity: "L5 — Feature complexa com múltiplos componentes, integração de IA e UI/UX rica."
  estimated_time: "12-16 horas"
  parallel_safe: false

# ─────────────────────────────────────────────────────────────────────────────
# SECTION 1: ROLE & OBJECTIVE
# ─────────────────────────────────────────────────────────────────────────────
role: "Expert React/TypeScript Developer com especialização em Healthcare SaaS e UI/UX de alta performance."
expertise_areas:
  - "React, TypeScript, TanStack Router, TailwindCSS, shadcn/ui"
  - "Design Systems e implementação pixel-perfect"
  - "Arquitetura de componentes para dashboards complexos"
  - "Integração de serviços de IA (análise de imagem, chat)"
  - "Conformidade com LGPD e boas práticas de segurança em saúde"

objective:
  task: "Implementar a nova página de gestão de pacientes (`/pacientes-v2/{patientId}`) no projeto NeonPro, focando em um prontuário visualmente rico, funcional e integrado com um assistente de IA para simulação de resultados."
  context: "O projeto é um sistema de gestão para clínicas de estética (Healthcare SaaS) construído com React, TypeScript e Supabase. A nova página deve aprimorar drasticamente a experiência do profissional ao acompanhar a jornada do paciente."
  measurable_outcome: "Uma Pull Request contendo a nova página totalmente funcional, responsiva, aderente ao design system, e com todos os testes de validação passando."

# ─────────────────────────────────────────────────────────────────────────────
# SECTION 2: CONTEXT & SCOPE (CRITICAL)
# ─────────────────────────────────────────────────────────────────────────────

### 2.1. Foundational Research (MUST READ)

Sua implementação deve ser guiada pelas descobertas destas pesquisas. Elas contêm as 'dores' do mercado e as melhores práticas que a nova página deve resolver.

- **Pesquisa de Mercado e Dores:** `/home/ubuntu/research-findings-aesthetic-clinics.md`
- **Pesquisa de UI/UX para Dashboards Médicos:** `/home/ubuntu/research-ux-medical-dashboards.md`

### 2.2. Design System (SOURCE OF TRUTH)

**A implementação deve seguir este Design System à risca.** Ele é a fonte da verdade para todos os aspectos visuais e de componentes.

- **Design System Completo:** `/home/ubuntu/design-system-neonpro-patients.md`

### 2.3. Implementation Plan (ATOMIC TASKS)

O plano de implementação detalha cada passo. Siga a ordem das fases e tarefas.

- **Plano de Implementação Detalhado:** `/home/ubuntu/pacientes-v2-spec.md`

### 2.4. Codebase Context

- **Repositório:** `/home/ubuntu/neonpro`
- **Análise da v1 (referência do que melhorar):**
  - A página atual (`/routes/patients/$patientId.tsx`) é funcional, mas carece de uma visão cronológica e de ferramentas visuais avançadas.
  - A UI é baseada em cards simples. A v2 deve ser mais interativa e rica em informações.
  - A integração com IA na v1 é um chat genérico. A v2 deve ter um chat contextualizado ao paciente e com capacidade de análise de imagem.

### 2.5. Out of Scope

- Modificações no banco de dados (schema). Assuma que os dados necessários estarão disponíveis via API.
- Criação de novas rotas de API no backend. Use os hooks e serviços existentes, adaptando-os se necessário.
- Alterações em outras páginas do sistema.

# ─────────────────────────────────────────────────────────────────────────────
# SECTION 3: IMPLEMENTATION RUNBOOK
# ─────────────────────────────────────────────────────────────────────────────

Execute as tarefas na ordem definida no `/home/ubuntu/pacientes-v2-spec.md`. Abaixo está um resumo do fluxo de trabalho.

### **Fase 1: Foundation & Setup (AT-101 a AT-103)**

1.  **Crie a estrutura de arquivos:**
    - `apps/web/src/routes/pacientes-v2/$patientId.tsx`
    - `apps/web/src/components/pacientes-v2/` (crie o diretório)
    - `apps/web/src/types/patient-v2.ts`
    - `apps/web/src/hooks/usePatientV2.ts`
2.  **Defina os tipos em `patient-v2.ts`** com base na análise dos requisitos (prontuário, fotos, documentos, etc.).
3.  **Implemente o layout principal em `$patientId.tsx`** com um header, uma área para as tabs e um container para o conteúdo, usando os componentes do `shadcn/ui` e seguindo o `design-system-neonpro-patients.md`.
4.  **Crie o hook `usePatientV2.ts`** que, inicialmente, retorna dados mockados para permitir o desenvolvimento da UI.

### **Fase 2: Core Patient Profile (AT-201 a AT-204)**

1.  **Crie os componentes de perfil** dentro de `apps/web/src/components/pacientes-v2/`.
2.  **`PatientHeaderV2.tsx`**: Implemente o cabeçalho com foto, nome, idade, status e badges. Use os ícones e a tipografia do design system.
3.  **`PatientInfoCard.tsx`**, **`PatientMedicalCard.tsx`**, **`PatientStatsCard.tsx`**: Crie cada card, populando-os com os dados mockados do hook. Preste atenção ao espaçamento, ícones e hierarquia visual definidos no design system.

### **Fase 3: Advanced Prontuário Features (AT-301 a AT-304)**

1.  **`PatientTimeline.tsx`**: Crie o componente de timeline. Cada evento deve ser um card dentro da timeline, conectado por uma linha vertical. Use os estilos de `Timeline (Prontuário)` do design system.
2.  **`PhotoGallery.tsx`**: Implemente a galeria de fotos como um grid de imagens. Adicione um estado de hover e um botão de ação em cada foto.
3.  **`PhotoComparisonView.tsx`**: Crie um modal que é acionado ao clicar em uma foto. Dentro do modal, implemente o componente de comparação com slider, conforme especificado no design system.
4.  **`DocumentManager.tsx`**: Crie um componente que lista os documentos e possui um botão de upload. Use o componente `Table` do `shadcn/ui` para a listagem.

### **Fase 4: AI Chat Widget Integration (AT-401 a AT-404)**

1.  **`AIChatWidget.tsx`**: Crie o componente do chat como um botão flutuante que, ao ser clicado, expande para um painel de chat. Use os estilos de `Chat IA Widget (Floating)` do design system.
2.  **Integre o upload de fotos:** Na `PhotoGallery`, adicione um botão "Analisar com IA" que abre o `AIChatWidget` e já envia a imagem para o contexto do chat.
3.  **Simulação de Resultados:** A funcionalidade principal. O chat deve ser capaz de receber uma imagem e um prompt. A resposta deve ser uma nova imagem gerada (simulação). Você irá simular a chamada para a API "Nano Banana" e exibir a imagem de resultado no chat.
4.  **`PromptSuggestions.tsx`**: Crie um componente que exibe botões com os prompts prontos (listados no `research-ux-medical-dashboards.md`) para guiar o usuário.

### **Fase 5: Polish & Validation (AT-501 a AT-504)**

1.  **Revise toda a página** em diferentes resoluções (mobile, tablet, desktop), ajustando o layout conforme o `design-system-neonpro-patients.md`.
2.  **Adicione `Skeleton` loaders** para todos os componentes que dependem de dados assíncronos.
3.  **Implemente `ErrorBoundary`** em volta das seções críticas (timeline, galeria) para exibir mensagens de erro amigáveis.
4.  **Escreva a documentação** para os novos componentes e hooks no Storybook (ou no README.md de cada componente).

# ─────────────────────────────────────────────────────────────────────────────
# SECTION 4: VALIDATION & QUALITY GATES
# ─────────────────────────────────────────────────────────────────────────────

Sua implementação só será considerada completa após passar por todas as validações abaixo.

### 4.1. Comandos de Validação (Executar após cada fase)

- **Linting:** `cd apps/web && bun run lint --fix` (Zero erros/warnings)
- **Type Checking:** `cd apps/web && bun run typecheck` (Zero erros)
- **Unit Tests:** `cd apps/web && bun run test` (Todos os testes passando)

### 4.2. Validação Visual e Funcional

- **Revisão do Design System:** Compare cada componente com o `design-system-neonpro-patients.md`. A implementação deve ser pixel-perfect.
- **Teste de Responsividade:** Use as ferramentas de desenvolvedor do Chrome para testar em pelo menos 3 larguras de tela (375px, 768px, 1280px).
- **Teste de Fluxo:** Execute o fluxo completo: abrir a página, ver a timeline, abrir a galeria, comparar fotos, enviar uma foto para a IA, receber a simulação.

### 4.3. Testes de Aceitação

- [ ] A página carrega em menos de 3 segundos.
- [ ] Todos os dados do paciente (mockados) são exibidos corretamente.
- [ ] A timeline de prontuário é rolável e exibe todos os eventos.
- [ ] O slider de comparação de fotos funciona suavemente.
- [ ] O chat de IA abre, recebe uma imagem e exibe uma imagem de resposta (simulada).
- [ ] A página não apresenta erros no console do navegador.

# ─────────────────────────────────────────────────────────────────────────────
# SECTION 5: DELIVERABLES & OUTPUT
# ─────────────────────────────────────────────────────────────────────────────

- **Principal Entregável:** Uma única Pull Request no repositório `GrupoUS/neonpro` contendo todas as alterações.
- **Título da PR:** `feat(patients): Implementa nova página de gestão de pacientes v2 com IA`
- **Descrição da PR:** Deve incluir um resumo das alterações, um link para este PRP, e screenshots/GIFs demonstrando a nova página em ação.
- **Código Fonte:** Todo o código deve estar dentro do diretório `apps/web/src/`.
- **Documentação:** Comentários no código para lógica complexa e documentação para os novos componentes no Storybook (se aplicável) ou em arquivos README.

# ─────────────────────────────────────────────────────────────────────────────
# SECTION 6: AI-SPECIFIC INSTRUCTIONS
# ─────────────────────────────────────────────────────────────────────────────

- **Foco na Qualidade:** Priorize a qualidade do código, a legibilidade e a manutenibilidade. Escreva um código que outro desenvolvedor (humano ou IA) possa entender e dar continuidade facilmente.
- **Siga o Design System:** Não desvie das especificações de cor, tipografia, espaçamento e componentes do `design-system-neonpro-patients.md`. Ele é sua principal fonte de verdade visual.
- **Componentização:** Crie componentes pequenos, reutilizáveis e com propósito único. Evite componentes monolíticos.
- **Estado de Loading e Erro:** Seja proativo na implementação de estados de loading (skeletons) e erro (error boundaries) para garantir uma boa experiência do usuário em todas as situações.
- **Simulação da IA:** Para a simulação da imagem com "Nano Banana", você pode usar um placeholder de imagem ou uma API de imagens aleatórias (como `picsum.photos`) para simular a resposta da IA. O importante é construir o fluxo completo.
- **Commits Atômicos:** Faça commits pequenos e focados para cada tarefa atômica concluída (ex: `feat(patients): cria componente PatientHeaderV2`).

